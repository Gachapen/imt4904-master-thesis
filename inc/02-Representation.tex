\chapter{Plant Representation With L-system}

\section{L-systems}
L-systems was introduced by Lindenmayer in 1968 as a ``theoretical framework for studying the development of simple multicellular organisms''~\cite{2012Prusinkiewicz}, and then later applied to model plants.
An L-system consists of an alphabet, an axiom and a set of production rules.
It is a parallel rewrite system where each letter in the axiom word is rewritten independently based on the production rules.
This happens iteratively, where a new word replaces the previous word each iteration.
A way to draw the plant based on the L-System has to be applied to visualize it.
Prusinkiewicz and Lindenmayer summarize multiple research papers into a comprehensive book about L-systems~\cite{2012Prusinkiewicz}.
For a more comprehensive and in-depth explanation of L-systems, refer to this book.

There are also multiple types of L-systems, including discrete, stochastic, context sensitive and parametric~\cite{2012Prusinkiewicz}.
All of these can be combined into one L-system.
A stochastic, context sensitive and parametric L-system (parametric S2L-System) can model all of the other types of L-System by having 100\% probabilities (discrete), no contexts or no parameters, and is thus the most flexible representation.
To be able to generate realistic looking plants with variations per instance, a parametric S2L-system is required.

Discrete context-free L-systems (D0L-systems) are the simplest L-systems, and can be created using edge rewriting, node rewriting, or both~\cite{2012Prusinkiewicz}.
In these systems, there exists one production rule per letter in the alphabet.
By default the productions will produce the same letter as the input (identity).

Stochastic L-systems add a randomness to the generation of the plants.
Each letter in the alphabet may have multiple productions, each with a probability of being selected~\cite{2012Prusinkiewicz}.
This may simulate how different instances of a plant species may look slightly different, thus making the plants look less synthetic when seen together with other plants of the same species.

Context sensitive L-systems add a context to the production rule.
The context can be on either left, right or both sides of the letter.
A production will only be used if the context matches the surrounding letters in the word.
With this, signal propagation can be simulated either upwards or downwards through the plant~\cite{2012Prusinkiewicz}, and more complex plants may be generated.

Parametric L-systems adds parameters to the letters in the words, and conditional rules~\cite{2012Prusinkiewicz}.
The main benefit of using parametric L-systems, is that it can work with rational numbers rather than only integers.
For example, with non-parametric L-systems, extension of a segment can be modeled with the rule $F\rightarrow FF$, or any number of ``F'' in the successor.
In any case, it will only be possible to grow the segment with a multiple of the previous.
For some plants, this is enough, but to model a larger variety of plants, rational numbers are required.
With parametric L-systems, the same rule would be $F(l)\rightarrow F(l*2)$, where $l$ is the length of the segment.
But now it is also possible to grow it at another rate, e.g.\ $F(l)\rightarrow F(l*1.2)$.
Prusinkiewicz and Lindenmayer describe more of the benefits of parametric L-systems~\cite{2012Prusinkiewicz}.

Prusinkiewicz describe L-systems as having three levels of model specification: partial L-systems, L-system schemata, and complete L-systems~\cite{2012Prusinkiewicz}.
The three different levels go from more abstract to more concrete, where partial L-systems specify which structures may result into which new structures (e.g.\ bud becomes a flower), schemata specifies when the different structure switches happen (e.g.\ when the bud becomes a flower), and complete systems specify the geometry of the plant to be visualized (e.g.\ how the bud and the flower should look).
Different methods exist for each level, and which method to use will depend on the type of plant that should be generated.

L-system schemata is of particular interest because there exists multiple methods to use.
The event of a structure resulting into a new structure is called a ``developmental switch''~\cite{2012Prusinkiewicz}.
The timing of the switches need to be controlled by a control mechanism in the system.
There are two classes of these mechanisms: lineage and interaction.
Lineage mechanisms are transferring information from a module to a descendant, while interaction mechanisms exchange information between cells.
Prusinkiewicz and Lindenmayer describe some of the mechanisms used.
The stochastic mechanism uses a stochastic L-system to apply probabilities to developmental switches.
A table L-system has multiple tables with different rules that can be applied depending on some external factor.
For example, one table can represent summer and another can represent winter, making different switches happen at different seasons.
The delay mechanism can delay the developmental switch by a specified number of iterations, for example making a flower bud bloom after a certain amount of iterations.
Accumulation of components uses parametric L-systems to accumulate some parameter until it reaches a threshold causing the switch to happen.
Parametric L-systems can also be used to control development switches with signals, where a signal travels either upwards or downwards through the plant.~\cite{2012Prusinkiewicz}

A popular way to render complete L-systems is the turtle interpretation, where a cursor (the turtle) follows instructions to draw lines, and the alphabet is the set of instructions to use~\cite{2012Prusinkiewicz}.
Turtle interpretation is in its original form simple and can only draw lines on a 2D image, but it has been extended to draw realistic looking plants in 3D~\cite{2012Prusinkiewicz}.
To use the turtle interpretation, extra parameters describing how much the L-system should be expanded and how it should be drawn has to be defined~\cite{2012Prusinkiewicz}.
For example, the number of rewrite iterations, the branching angle, the segment length, and the segment width have to be specified.
This may depend on the plant to be rendered, as some plants might require a more complex set of drawing instructions.

\section{Genetically Evolving L-systems}
Genetic evolution involves crossing genes from parents to create an offspring.
Thus, the research field of L-system genetic evolution is a good starting point for finding out how L-systems can be combined into offspring with distinct features from both parents, potentially providing a basis for answering \textit{RQ2} and \textit{RQ3}.
A set of research papers published between 1995 and 2013 was studied to see what different techniques have been used.

When evolving objects, an evolutionary algorithm (EA) is often used.
EA is composed of a series of steps that will evolve a population over multiple generations based on some criteria.
It begins by generating an initial population of individuals.
Then it evaluates the individuals with a fitness function.
This is then used to select the best individuals to be used for reproduction.
The individuals are then used to create offspring for a new population by using crossover and mutation.
Finally, the new population is evaluated and the steps repeat.
In the context of L-systems, the \textit{object} will be replaced with L-system.

To get a better overview of the EA techniques used for L-systems, the EA has been split into five parts: model, representation, generation, selection, and genetic operators.
The \textit{model} and \textit{representation} are related and sometimes almost equal.
The difference is that the model describes how the plant is modeled, while the representation may be a small part of the model or the model represented in a different format, and is the part which is evolved by the algorithm.
\textit{Generation} is how the representations are generated, e.g.\ for the initial population, or when replacing parts of an L-system with a new part.
\textit{Selection} is the part of selecting individuals to be used for creating the next generation.
\textit{Genetic operators} are used on the selected individuals to modify the representation by either doing crossover between parents, mutating an offspring, or both.

\subsection{Model}
Discrete context-free L-systems (D0L-systems) are the simplest form of L-systems and is commonly used for EA~\cite{1998Mock,1998Ochoa,2002Ebner,2003Ebner,2006Ashlock,2009Beaumont}.
Parametric discrete context-free L-systems (PD0L-systems) have also been prominently used in research for EA~\cite{1994Jacob,2000Vanak,2001Hornby}.
Parametric discrete context-sensitive L-systems (PDIL-systems) was used in Jacob's further work by extending the PD0L-system version~\cite{1995Jacob, 1996Jacob, 1996Jacob-2}.
Other types of L-systems, such as stochastic, timed, table, environmentally-sensitive and open L-systems have not been used for EA in research.
Hornby and Pollack argue that stochastic L-systems are hard to use for EA because they are non-deterministic~\cite{2001Hornby}.
Additionally, they argue that context-sensitive L-systems are not as powerful as parametric L-systems, and should thus not be used.
They use PD0L-systems in their own research, but it is worth noting that they evolve moving creatures rather than plants.

All of the above-mentioned L-systems are bracketed L-systems, i.e.\ they include stack operators (\textit{[} and \textit{]}) in their alphabets to push and pop the current interpretation state.
Additionally, Hornby and Pollack use repetition brackets (\textit{\{} and \textit{\}}) with an integer parameter to specify how many times the content inside the brackets should be repeated~\cite{2001Hornby}.

The L-system type is only the first part of the model required to model a plant.
The second and final part is the interpretation of the L-system into a visualized model.
Even though researchers only use three types of L-systems (D0L, PD0L and PDIL), they use different ways of interpreting it.
Both Mock, Ochoa, and Beaumont and Stepney visualize the L-systems in 2D with branching, but while Mock uses node rewriting~\cite{1998Mock}, Ochoa and Beaumont and Stepney use edge rewriting~\cite{1998Ochoa,2009Beaumont}, which results in different types of plants.
The remaining authors use 3D visualization with branching~\cite{1994Jacob,2006Ashlock}, though Jacob adds the concepts of sprout, stalk leaf and bloom~\cite{1995Jacob}, and Ebner et al.\ only add leaves~\cite{2002Ebner,2003Ebner}.

\subsection{Representation}
The representation used for EA also varies.
In the research, there have been three main EA methods: genetic programming (GP), genetic algorithms (GA) and grammar evolution (GE).
Jacob and Ochoa use the GP methods~\cite{1994Jacob,1995Jacob,1998Ochoa}, both based on techniques introduced by Koza~\cite{1992Koza}.
Ochoa uses a simple version of GP, where representation only consists of one single rule successor~\cite{1998Ochoa}.
The successor is divided into a hierarchy based on the branching in the string, such that top-level letters are on the top, and each stack below is one level down.
In their paper, they only use successors with one level deep branching.

Jacob represents the whole L-system as a tree structure, such as a GP method commonly does~\cite{1994Jacob}.
The tree structure starts with the L-system root at the top, then with the axiom and rules as children, then with each rule as a child of rules.
The axiom has one child for each letter, and each letter has a child for the parameter.
Each rule have a left and right side, where the left is the predecessor and the right is the predecessor.
The left node is composed the same way as the axiom, but without parameters..
The right node is also the same, but it can have parameters and also stacks for branching that also follow a tree structure.
It can practically represent any PD0L-system this way, but without conditions and with a limited set of letters.
This could be extended.

GA is the second major method used in the research.
The main difference between GA and GP is that GA represents the genotype as a flat string of elements, while GP represents it as a tree structure.
Both Mock and Ochoa use only a single rule successor to represent the genotype~\cite{1998Mock,1998Ochoa}.
The successor is a plain string of symbols, including letters and the branching operators.

Ebner et al.\ represent the genotype as a set of production rules with one edge rewriting rule and 0--26 node rewriting rules, each with individual nodes ranging from A--Z~\cite{2002Ebner,2003Ebner}.
The predecessor is fixed based on the rule number.
For example, the first rule predecessor is always \textit{f}, while the second and third predecessors would be \textit{A} and \textit{B}.
This means that the genotype is a set of strings (successors), instead of one single string.
This would allow the GA to search a bigger space compared to Mock and Ochoa's genotypes.
Hornby and Pollack takes this further and represents the genotype as a fixed number of production rules composed of a predecessor and successor~\cite{2001Hornby}.
In this case, the genotype has as set of pairs of strings, which would allow the GA to search a even bigger space.

Finally, Ashlock et al.\ encodes the L-system as a string of real numbers~\cite{2006Ashlock}.
Some of numbers encoded are used to index a table of a fixed set of rules, and some are used directly in the interpretation step.
None of the previous genotypes presented represented the interpretation, though Ebner et al. and Hornby and Pollock used PD0L-systems where some interpretation parameters can be moved into the L-system production strings.
Even though the encoded genotype can affect more aspects of the L-system (rules and interpretation), it is more limited because of its fixed set of rules that are used.
Thus it can search a smaller space than Hornby and Pollack's representation.

GE is the final and latest method used in the research.
It was introduced for L-systems by Beaumont and Stepney to evolve a D0L-system to match an object~\cite{2009Beaumont}.
Interestingly, L-systems themselves are grammar that produce plants, but Beaumont and Stepney's work define a grammar that produce the L-systems, which then is used to produce the plant.
They represent the genome as a string of numbers that index into a Backus Naur Form (BNF) grammar to build the L-system.
In this sense the representation is similar to that of Ashlock~\cite{2006Ashlock}, but with integers instead of real numbers and a different way of mapping from numbers to the L-system.
It is also similar to Jacob's GP representation because it uses a pool of expressions that could be compared to a BNF.
When undergoing evolution, the genotype (string of numbers) will be modified by a GA.
Thus the GE method is strongly related to GA.

Beaumont and Stepney use a limited search space for the GE method.
Their alphabet only consists of \textit{F}, \textit{+} and \textit{-}, their axiom is always \textit{F}, and only \textit{F} can be the production predecessor (i.e.\ it is an edge rewriting L-system).
They also have a fixed number of iterations and rotation angle.
This can be expanded, and they did some experiments to try this.
\textit{+} and \textit{-} was added as predecessor letters, and the axiom was allowed to contain any symbols and have any length.
This expanded the search space, making the algorithm find fewer very bad solutions, but also far fewer good solutions.
Finally they added a second terminal symbol \textit{X} in addition to \textit{F}, allowing for both edge and node rewriting L-systems.
This further expanded the search space, but required a significantly larger population size and more generations, making the computation time significantly longer.
The search space for this GE representation is smaller than some of the other methods because of its use of non-parametric L-systems and limited set of symbols, but it could be expanded to include this.

In addition, there is a non-EA method introduced by Vanak that still is relevant, called XL-system~\cite{2000Vanak}.
Rather than evolving L-systems, the XL-system is another form of L-systems where two or more PD0L-systems are combined with an X-machine into an XL-system.
The original L-systems are not modified in any way, but rather kept as two states in the X-machine.
The XL-system is used as a normal L-system, running a specified amount of derivations to rewrite an axiom.
The difference is that the XL-system switches between the contained L-systems based on specified conditions while iterating.
The active L-system is the one switched to, and is the one that will be used for rewriting the axiom in the current derivation.
This means that it for example can alternate between the productions of two L-systems every derivation, creating a phenotype with properties from both L-systems.

The phenotypes achieved from the XL-systems are perfect for ``[creating] offspring that contain distinct features from both parents'', which is the goal of the third research question (RQ3).
The big benefit of XL-systems is that they are a lossless combination of L-systems, compared to the EA methods presented where properties of the L-systems may be lost.
The drawback is that the original L-systems have to be stored, causing an XL-system combining several generations of L-systems to be a large and complex structure.

\subsection{Generation}

\subsection{Selection}

\subsection{Genetic Operators}

\section{Features in L-systems}
